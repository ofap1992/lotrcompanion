<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOTR Journey Companion</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; background-color: #161310; color: #d4c3a1; font-family: "Georgia", serif; }
        * { box-sizing: border-box; }
        input[type=range] { cursor: pointer; accent-color: #c1a45d; }
        .nav-bar { display: flex; justify-content: space-between; align-items: center; background-color: #1e1a15; padding: 10px 15px; border: 1px solid #3d3329; border-radius: 4px; margin-bottom: 10px; }
        .nav-bar select { background-color: #161310; color: #c1a45d; border: 1px solid #3d3329; padding: 5px; font-family: "Georgia", serif; border-radius: 4px; width: 75%; }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // =========================================================
        // 1. EDITABLE CONTENT AREA
        // =========================================================
        const JOURNEY_DATA = {
            bookTitle: "THE FELLOWSHIP OF THE RING",
            departureDate: "September 23",
            chapters: [
                {
                    number: 1,
                    title: "A LONG-EXPECTED PARTY",
                    location: "Hobbiton (Bag End)",
                    currentDate: "September 22",
                    coords: { x: 27.6, y: 5.0 },
                    illustrations: [
                        { url: "https://i.imgur.com/GBSMRsK.jpeg", label: "Bag End" },
                        { url: "https://i.imgur.com/yQEGPTw.jpeg", label: "Gandalf" }
                    ],
                    videos: [{ id: "9B6dsfGazyI", label: "Roads Go Ever On" }]
                },
                {
                    number: 2,
                    title: "THE SHADOW OF THE PAST",
                    location: "The Shire",
                    currentDate: "September 25",
                    coords: { x: 21.0, y: 23.5 },
                    illustrations: [],
                    videos: []
                }
            ]
        };

        const ACTIVE_CHAPTER_INDEX = 0; 

        const LOTRCompanion = () => {
            const current = JOURNEY_DATA.chapters[ACTIVE_CHAPTER_INDEX];
            const [mapPos, setMapPos] = useState(current.coords);
            const [zoom, setZoom] = useState(350);
            const [isDragging, setIsDragging] = useState(false);
            const mapRef = useRef(null);
            const lastPos = useRef({ x: 0, y: 0 });

            const pathPoints = JOURNEY_DATA.chapters
                .slice(0, ACTIVE_CHAPTER_INDEX + 1)
                .map(ch => ch.coords);

            const handleStart = (clientX, clientY) => {
                setIsDragging(true);
                lastPos.current = { x: clientX, y: clientY };
            };

            const handleMove = (clientX, clientY) => {
                if (!isDragging) return;
                const dx = clientX - lastPos.current.x;
                const dy = clientY - lastPos.current.y;
                const sensitivity = 0.3 * (100 / zoom);
                setMapPos(prev => ({ x: prev.x - dx * sensitivity, y: prev.y - dy * sensitivity }));
                lastPos.current = { x: clientX, y: clientY };
            };

            const handleMapClick = (e) => {
                if (Math.abs(e.clientX - lastPos.current.x) > 5) return;
                const rect = mapRef.current.getBoundingClientRect();
                const clickX = (e.clientX - rect.left) / rect.width;
                const clickY = (e.clientY - rect.top) / rect.height;
                const zoomFactor = 100 / (zoom / 100);
                setMapPos({ 
                    x: mapPos.x + (clickX - 0.5) * zoomFactor, 
                    y: mapPos.y + (clickY - 0.5) * zoomFactor 
                });
            };

            const styles = {
                container: { maxWidth: "500px", margin: "0 auto", display: "flex", flexDirection: "column", gap: "25px", padding: "20px" },
                section: { backgroundColor: "#1e1a15", border: "1px solid #3d3329", padding: "15px", borderRadius: "4px" },
                boxLabel: { fontSize: "0.6rem", color: "#8c7a65", textTransform: "uppercase", letterSpacing: "1px", marginBottom: "12px", display: "block" },
                itemLabel: { fontSize: "0.75rem", color: "#c1a45d", marginBottom: "8px", borderBottom: "1px solid #3d3329", paddingBottom: "4px", display: "block" },
                mapWrapper: { width: "100%", height: "350px", border: "2px solid #c1a45d", position: "relative", overflow: "hidden", borderRadius: "4px", cursor: isDragging ? "grabbing" : "grab", touchAction: "none" }
            };

            return (
                <div style={styles.container}>
                    <nav className="nav-bar">
                        <span style={{fontSize: '0.65rem', color: '#8c7a65'}}>GO TO:</span>
                        <select defaultValue="" onChange={(e) => { if(e.target.value) window.location.href = e.target.value; }}>
                            <option value="" disabled>Select a Chapter...</option>
                            <optgroup label="FELLOWSHIP OF THE RING">
                                <option value="index.html">Ch 1: A Long-Expected Party</option>
                                <option value="chapter2.html">Ch 2: The Shadow of the Past</option>
                                <option value="chapter3.html">Ch 3: Three Is Company</option>
                                <option value="chapter4.html">Ch 4: A Shortcut to Mushrooms</option>
                                <option value="chapter5.html">Ch 5: A Conspiracy Unmasked</option>
                                <option value="chapter6.html">Ch 6: The Old Forest</option>
                                <option value="chapter7.html">Ch 7: In the House of Tom Bombadil</option>
                                <option value="chapter8.html">Ch 8: Fog on the Barrow-Downs</option>
                                <option value="chapter9.html">Ch 9: At the Sign of the Prancing Pony</option>
                                <option value="chapter10.html">Ch 10: Strider</option>
                                <option value="chapter11.html">Ch 11: A Knife in the Dark</option>
                                <option value="chapter12.html">Ch 12: Flight to the Ford</option>
                                <option disabled>── BOOK TWO ──</option>
                                <option value="chapter1-b2.html">Ch 1: Many Meetings</option>
                                <option value="chapter2-b2.html">Ch 2: The Council of Elrond</option>
                                <option value="chapter3-b2.html">Ch 3: The Ring Goes South</option>
                                <option value="chapter4-b2.html">Ch 4: A Journey in the Dark</option>
                                <option value="chapter5-b2.html">Ch 5: The Bridge of Khazad-dûm</option>
                                <option value="chapter6-b2.html">Ch 6: Lothlórien</option>
                                <option value="chapter7-b2.html">Ch 7: The Mirror of Galadriel</option>
                                <option value="chapter8-b2.html">Ch 8: Farewell to Lórien</option>
                                <option value="chapter9-b2.html">Ch 9: The Great River</option>
                                <option value="chapter10-b2.html">Ch 10: The Breaking of the Fellowship</option>
                            </optgroup>
                        </select>
                    </nav>

                    <header style={{ textAlign: "center", borderBottom: "1px solid #3d3329", paddingBottom: "15px" }}>
                        <div style={{ fontSize: "0.8rem", color: "#8c7a65", letterSpacing: "2px" }}>{JOURNEY_DATA.bookTitle}</div>
                        <h1 style={{ fontSize: "1.4rem", color: "#f2e6d0" }}>Chapter {current.number}: {current.title}</h1>
                    </header>

                    <section style={styles.section}>
                        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "10px" }}>
                            <span style={styles.boxLabel}>Location: {current.location}</span>
                            <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                <small style={{fontSize: '0.6rem', color: '#8c7a65'}}>ZOOM</small>
                                <input type="range" min="100" max="1000" value={zoom} onChange={(e) => setZoom(Number(e.target.value))} />
                            </div>
                        </div>
                        
                        <div ref={mapRef} style={styles.mapWrapper}
                            onMouseDown={(e) => handleStart(e.clientX, e.clientY)}
                            onMouseMove={(e) => handleMove(e.clientX, e.clientY)}
                            onMouseUp={(e) => { setIsDragging(false); handleMapClick(e); }}
                            onTouchStart={(e) => handleStart(e.touches[0].clientX, e.touches[0].clientY)}
                            onTouchMove={(e) => handleMove(e.touches[0].clientX, e.touches[0].clientY)}
                            onTouchEnd={() => setIsDragging(false)}
                        >
                            <div style={{
                                position: "absolute", width: `${zoom}%`, height: `${zoom}%`,
                                left: `${50 - mapPos.x * (zoom/100)}%`,
                                top: `${50 - mapPos.y * (zoom/100)}%`,
                                transition: isDragging ? "none" : "left 0.3s ease-out, top 0.3s ease-out"
                            }}>
                                <img src="https://i.redd.it/r8403tg0wo5c1.jpeg" style={{ width: "100%", height: "100%", display: "block" }} />
                                <svg viewBox="0 0 100 100" style={{ position: "absolute", top: 0, left: 0, width: "100%", height: "100%", pointerEvents: "none" }}>
                                    {pathPoints.length > 1 && (
                                        <path d={pathPoints.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ')} 
                                        fill="none" stroke="#c1a45d" strokeWidth="0.5" strokeDasharray="1,1" />
                                    )}
                                    <circle cx={current.coords.x} cy={current.coords.y} r="0.8" fill="#ff4444" style={{ animation: 'pulse 2s infinite' }} />
                                </svg>
                            </div>
                            <div style={{ position: 'absolute', bottom: '10px', right: '10px', backgroundColor: 'rgba(0,0,0,0.8)', color: '#c1a45d', padding: '4px 8px', fontSize: '0.7rem', borderRadius: '4px', border: '1px solid #c1a45d' }}>
                                X: {mapPos.x.toFixed(1)}% | Y: {mapPos.y.toFixed(1)}%
                            </div>
                        </div>
                    </section>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LOTRCompanion />);
    </script>
</body>
</html>
